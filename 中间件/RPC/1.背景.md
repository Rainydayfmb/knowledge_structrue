# RPC 背景
## 服务之RPC
该章节[参考这里](https://juejin.im/post/5a5ee63d518825732914748c)
### 相关背景
随着业务的发展、用户量的增长，系统数量增多，调用依赖关系也变得复杂，为了确保系统高可用、高并发的要求，系统的架构也从单体时代慢慢迁移至服务SOA时代，**根据不同服务对系统资源的要求不同，我们可以更合理的配置系统资源，使系统资源利用率最大化**。
![avatar](https://user-gold-cdn.xitu.io/2018/1/17/16102b35e64b0107?imageView2/0/w/1280/h/960/ignore-error/1)
- **单一应用架构** 当网站流量很小时，只需一个应用，将所有功能都部署在一起，以减少部署节点和成本。此时，用于简化增删改查工作量的 数据访问框架(ORM) 是关键。
- **垂直应用架构** 当访问量逐渐增大，单一应用增加机器带来的加速度越来越小，将应用拆成互不相干的几个应用，以提升效率。
此时，用于加速前端页面开发的 Web框架(MVC) 是关键。
- **分布式服务架构**
当垂直应用越来越多，应用之间交互不可避免，将核心业务抽取出来，作为独立的服务，逐渐形成稳定的服务中心，使前端应用能更快速的响应多变的市场需求。此时，用于提高业务复用及整合的 分布式服务框架(RPC) 是关键。
- **流动计算架构**
当服务越来越多，容量的评估，小服务资源的浪费等问题逐渐显现，此时需增加一个调度中心基于访问压力实时管理集群容量，提高集群利用率。此时，用于提高机器利用率的 资源调度和治理中心(SOA) 是关键。

### 服务带来的挑战
系统的复杂度上升、服务依赖关系、服务性能监控、全链路日志、容灾、断路器、限流等。

根据现在团队的业务系统情况，首先我们要**梳理出现存的问题是什**么：
- 多种调用传输方式：HTTP方式、WebService方式；
- 服务调用依赖关系：人工记录，查看代码分析；
- 服务调用性能监控：日志记录，人工查看时间；
- 服务与应用紧耦合：服务挂掉，应用无法可用；
- 服务集群负载配置：Nginx配置，存在单点问题；

在去选择技术框架时，技术框架最基本要解决上面现存问题，同时我们也要确认出我们的期望，**要达到的目标是什么**：
- 支持当前业务需求，这是最最基本的条件；
- 服务避免单点问题，去中心化；
- 服务高可用、高并发，解耦服务依赖；
- 服务通用化，支持异构系统调用服务；
- 服务依赖关系自维护，可视化(阿里云AHAS)；
- 服务性能监控自统计，可视化（鹰眼）；
- 服务需自带注册、发现、健康检查、负载均衡等特性；
- 开发人员关注度高，上手快，简单轻量，低侵入；

#### mas(微服务)和soa(面向服务架构的区别和联系)
[参考](https://blog.csdn.net/qq_15071263/article/details/84027556)
##### 相似之处
- 都是面向服务
- 都是基于HTTP协议

##### 区别和联系
传统的SOA 一般是大而全的单块架构，MSA 是很分散的服务。
一般情况下，SOA需要对整个系统进行规范约束，但是MSA的每个服务都可以有自己的开发语言和开发方式，灵活性比SOA更高。

###### 基于SOA的架构
1、易于部署，只需要扔war包就可以了
2、易于伸缩，只需要在负载均衡下部署应用的拷贝即可
3、拥有较为庞大的代码库，在理解业务时，会造成困扰
4、当项目随着时间的变化越来越大的时候，IDE的速度会变慢
5、Web容器超载，应用变大时，Web容器的启动时间变长
6、在持续部署上存在问题，当你只需要更新某一个组件时，必须重新部署整个应用
7、伸缩性不好，单块架构只能在一个维度伸缩
8、难以调整开发规模
9、需要对一个技术栈长期投入，比如使用Java，那么脱离JVM，Java的开发环境就不能给项目开发组件，并且，项目的迁移也受限于语言和框架层面，或者面临技术升级时，在某些情况下不得不重写整个应用

##### 基于微服务的架构
在优点上
1、每个微服务都相对较小
2、易于开发者理解
3、IDE反应更快，开发更搞笑
4、Web 容器启动更快
5、每个服务可以独立开发，部署
6、易于伸缩开发组织架构
7、提升故障隔离
8、消除了单一技术栈的长期投入

在缺点上
1、需要分布式系统发额外复杂度
2、测试更加困难
3、实现跨服务的用例需要开发者之间的细致协作
4、生产环境的部署复杂度增加
5、更大的内存开销

**两者之间最关键的区别在于**，微服务专注于以自治的方式产生价值。但是两种架构背后的意图是不同的：SOA尝试将应用集成，一般采用中央管理模式来确保各应用能够交互运作。微服务尝试部署新功能，快速有效地扩展开发团队。它着重于分散管理、代码再利用与自动化执行。

功能 | SOA | 微服务
:-: | :-: | :-:
组件大小 | 大块业务逻辑 | 单独任务或小块业务逻辑
耦合 | 通常松耦合| 总是松耦合
公司架构 | 任何类型 | 小型、专注于功能交叉的团队
管理 | 着重中央管理 | 着重分散管理
目标 | 确保应用能够交互操作 | 执行新功能，快速拓展开发团队

微服务并不是一种新思想的方法。它更像是一种思想的精炼，一种SOA的精细化演进，并且更好地利用了先进的技术以解决问题，例如容器与自动化等。所以对于我们 去选择服务技术框架时，并不是非黑即白，而是针对SOA、MSA两种架构设计同时要考虑到兼容性，对于现有平台情况架构设计，退则守SOA，进则攻MSA，阶段性选择适合的。